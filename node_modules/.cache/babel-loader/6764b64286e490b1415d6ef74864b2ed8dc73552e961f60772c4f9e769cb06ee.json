{"ast":null,"code":"import _regeneratorRuntime from\"/home/dipti/Codes/Dursikshya 1-2/REACT/Ecommerce_React_main/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/home/dipti/Codes/Dursikshya 1-2/REACT/Ecommerce_React_main/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/home/dipti/Codes/Dursikshya 1-2/REACT/Ecommerce_React_main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{CardCvcElement,CardExpiryElement,CardNumberElement,useElements,useStripe}from'@stripe/react-stripe-js';import React from'react';import Swal from'sweetalert2';import Footer from'../Footer';import Navbar from'../Navbar';import{isAuthenticated}from'../../api/userAPI';import{processPayment}from'../../api/paymentAPI';import{placeOrder}from'../../api/orderAPI';import{useNavigate}from'react-router-dom';import{useDispatch}from'react-redux';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Payment=function Payment(){var _isAuthenticated=isAuthenticated(),user=_isAuthenticated.user,token=_isAuthenticated.token;var stripe=useStripe();var elements=useElements();var navigate=useNavigate();var dispatch=useDispatch();var makePayment=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var amount,_yield$processPayment,client_secret,result,orderItems,shipping_info,order;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;document.getElementById('payBtn').disabled=true;amount=sessionStorage.getItem('total')*100;_context.next=6;return processPayment(amount,token);case 6:_yield$processPayment=_context.sent;client_secret=_yield$processPayment.client_secret;_context.next=10;return stripe.confirmCardPayment(client_secret,{payment_method:{card:elements.getElement(CardNumberElement),billing_details:{name:user.usename,email:user.email}}});case 10:result=_context.sent;if(result.error){Swal.fire('error',result.error.message,'error');document.getElementById('payBtn').disabled=false;}else{//place order\norderItems=JSON.parse(localStorage.getItem('cart_items'));shipping_info=JSON.parse(localStorage.getItem('shipping_info'));order=_objectSpread(_objectSpread({},orderItems),{},{user:user._id},shipping_info);placeOrder(order).then(function(data){if(data.error){Swal.fire('error',data.error,'error');}else{//remove items from cart\nlocalStorage.removeItem('cart_items');//remove from reducer\ndispatch({type:\"EMPTY_CART\"});document.getElementById('payBtn').disabled=false;Swal.fire('success','Your order has been placed successfully','success').then(function(){return navigate('/home');});}});}_context.next=18;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](1);Swal.fire('error',_context.t0.message,'error');document.getElementById('payBtn').disabled=false;case 18:case\"end\":return _context.stop();}},_callee,null,[[1,14]]);}));return function makePayment(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Navbar,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-50 p-50\",children:\"Cart information, shipping information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-50 p-5\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card-number\",children:\"Card Number\"}),/*#__PURE__*/_jsx(CardNumberElement,{id:\"card-number\",className:\"form-control\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card-expiry\",children:\"Valid up to\"}),/*#__PURE__*/_jsx(CardExpiryElement,{id:\"card-expiry\",className:\"form-control\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card-cvc\",children:\"CVC\"}),/*#__PURE__*/_jsx(CardCvcElement,{id:\"card-cvc\",className:\"form-control\"}),/*#__PURE__*/_jsx(\"buton\",{classsName:\"btn btn-warning w-100 mt-3\",id:\"payBtn\",onClick:makePayment,children:\"Make Payment\"})]})]}),/*#__PURE__*/_jsx(Footer,{})]});};export default Payment;","map":{"version":3,"names":["CardCvcElement","CardExpiryElement","CardNumberElement","useElements","useStripe","React","Swal","Footer","Navbar","isAuthenticated","processPayment","placeOrder","useNavigate","useDispatch","Payment","user","token","stripe","elements","navigate","dispatch","makePayment","e","preventDefault","document","getElementById","disabled","amount","sessionStorage","getItem","client_secret","confirmCardPayment","payment_method","card","getElement","billing_details","name","usename","email","result","error","fire","message","orderItems","JSON","parse","localStorage","shipping_info","order","_id","then","data","removeItem","type"],"sources":["/home/dipti/Codes/Dursikshya 1-2/REACT/Ecommerce_React_main/src/Components/Layout/Pages/Payment.jsx"],"sourcesContent":["import { CardCvcElement, CardExpiryElement, CardNumberElement, useElements, useStripe } from '@stripe/react-stripe-js'\nimport React from 'react'\nimport Swal from 'sweetalert2'\nimport Footer from '../Footer'\nimport Navbar from '../Navbar'\nimport { isAuthenticated } from '../../api/userAPI'\nimport { processPayment } from '../../api/paymentAPI'\nimport { placeOrder } from '../../api/orderAPI'\nimport { useNavigate } from 'react-router-dom'\nimport { useDispatch } from 'react-redux'\n\nconst Payment = () => {\nconst {user, token} = isAuthenticated()\nconst stripe = useStripe()\nconst elements = useElements()\nconst navigate = useNavigate()\nconst dispatch = useDispatch()\n\n\n  const makePayment = async (e)=> {\n    e.preventDefault()\n    try {\n      document.getElementById('payBtn').disabled = true\n      let amount = sessionStorage.getItem('total')*100\n\n     let {client_secret} = await processPayment (amount, token) \n\n     let result = await stripe.confirmCardPayment(client_secret, {\n      payment_method: {\n        card: elements.getElement(CardNumberElement),\n        billing_details: {\n          name: user.usename,\n          email: user.email\n        }\n      }\n     })\n\n     if(result.error) {\n      Swal.fire('error', result.error.message, 'error')\n      document.getElementById('payBtn').disabled=false\n }\n else {\n  //place order\n  let orderItems = JSON.parse(localStorage.getItem('cart_items'))\n  let shipping_info = JSON.parse(localStorage.getItem('shipping_info'))\n  let order = {\n    ...orderItems,\n    user: user._id,\n    ...shipping_info\n  }\n  placeOrder(order)\n  .then(data => {\n    if (data.error){\n      Swal.fire('error',data.error, 'error')\n    }\n    else {\n        //remove items from cart\n        localStorage.removeItem('cart_items')\n        //remove from reducer\n        dispatch({type: \"EMPTY_CART\"})\n        document.getElementById('payBtn').disabled = false\n      Swal.fire('success','Your order has been placed successfully', 'success')\n      .then(()=> navigate('/home'))\n  }\n  })\n\n}\n    }\n\n    catch(error){\n      Swal.fire('error',error.message, 'error')\n      document.getElementById('payBtn').disabled=false\n\n    }\n  }\n  return (\n    <>\n    <Navbar/>\n    <div className ='d-flex'>\n    <div className = 'w-50 p-50'>\n        Cart information, shipping information\n    </div>\n    <div className = 'w-50 p-5'>\n        <label htmlFor = \"card-number\">Card Number</label>\n        <CardNumberElement id='card-number' className = 'form-control'/>\n        <label htmlFor = \"card-expiry\">Valid up to</label>\n        <CardExpiryElement id ='card-expiry' className = 'form-control'/>\n        <label htmlFor = \"card-cvc\">CVC</label>\n        <CardCvcElement id ='card-cvc' className =\"form-control\"/>\n        <buton classsName ='btn btn-warning w-100 mt-3' id='payBtn' onClick ={makePayment}>Make Payment</buton>\n    </div>\n    </div>\n\n    <Footer/>\n    </>\n  )\n}\n\nexport default Payment"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}